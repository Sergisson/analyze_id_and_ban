# analyze_id_and_ban
Сервис рейтинга подозрительности пользователя.
Рейтинг рассчитывается за N минут(устанавливается в настройках), если за это время будет рассчитан новый рейтинг, 
отсчет начнется заново. Если время истечет, рейтинг сбросится до 0.

Расчет происходит в отдельной системе анализа подозрительности.

# Реализация
Ендпоинт получения подозрительности возвращает значения подозрительности из redis.

При запросе подозрительности сервис проверяет, хранится ли оно в хранилище данных и возвращает это значение или 0. 
Если значения не было, отправляется запрос в систему анализа на подозрительность. В ней возможна проверка,
а так же отправка в сервис анализа для проверки на подозрительность.

Расчетом подозрительности занимается другой сервис.
Для получения ответа от сервиса анализа используется отдельный ендпоинт по добавления уровня подозрительности.

# Технологии
Для хранения подозрительности используется redis 
Для транспорта в сервис проверки на подозрительность - rabbitmq.
Код написал для легкой замены этих технологий.

# Запуск приложения
## Docker
build:
```bash
docker build . -t analyze_id_and_ban
```
run:
```bash
docker-compose up
```
Все env-ы лежат в `docker-compose` файле.

## Venv
Нужно файл `local.env` из папки src скопировать и переименовать как `.env` и добавить чтение из него.
Команда для запуска сервиса:
```bash
python -m src
```
Так же нужно настроить работу redis и rabbitMQ локально (это не делалось, т.к. запуск производился через docker-compose)

# Инструменты для разработки
Ремарка: можно использовать sh или make файлы для автоматизации запусков. Или pycharm, тут дело вкуса.

Для запуска isort (автоматическая сортировка и форматирование импортов):
```bash
python -m isort .
```
Для запуска black(автоматическое форматирование кода):
```bash
python -m black .
```
Запуск тестов (или через pycharm):
```bash
python -m pytest tests
```
Просмотр описания api (swagger:)
```
service_adress:port/swagger/
```
Локально:
```
http://127.0.0.1:8000/
```
# TODO
- Вынести connection и chanel выше и инициализировать 1 раз для redis и rabbitMQ
- Добавить healthcheck-и
- Добавить простейший сервис для анализа (читает из очереди, генерирует число и отправляет обратно в endpoint первого сервиса)